{
  "templates": {
    "map_info_generation": {
      "name": "map_info_generation",
      "category": "map_generation",
      "template": "为一个{width}x{height}的冒险区域（第{depth}阶段/层级）生成名称和描述。\n基础场景风格：{theme}{quest_info}\n\n请返回JSON格式：\n{{\n    \"name\": \"地图名称（中文，体现主题与任务特色）\",\n    \"description\": \"地图描述（详细描述环境、氛围与潜在挑战，包含室内/室外、天气/光照等信息）\",\n    \"floor_theme\": \"场景主题类型（必须从以下选项中选择一个）\"\n}}\n\n**场景主题选项说明（并列展示）**：\n【地下/室内系列】\n- \"normal\": 普通地牢（石质地板+裂纹效果）\n- \"magic\": 魔法房间（大理石+魔法符文）\n- \"abandoned\": 废弃房间（木质地板+苔藓）\n- \"cave\": 洞穴（泥土地面+水渍）\n- \"combat\": 战斗区域（石质地板+血迹）\n\n【地上/自然系列】\n- \"grassland\": 草地（绿色草地+野花）\n- \"desert\": 沙漠（黄沙+脚印）\n- \"farmland\": 农田（耕地+作物）\n- \"snowfield\": 雪地（白雪+冰晶）\n- \"town\": 城镇街道（石板路/木栅/集市）\n\n**选择指南（不使用负面约束）**：\n- 出现“城镇/村庄/街道/集市/旅店/教堂”等关键词 → 选择 \"town\"\n- 出现“草原/森林/野外/自然/林地/田园/绿地”等 → 选择 \"grassland\"\n- 出现“雪/冰/暴雪/寒冷/冻土/冬季”等 → 选择 \"snowfield\"\n- 出现“沙漠/荒地/沙丘/炙热/干旱”等 → 选择 \"desert\"\n- 出现“农场/田地/庄稼/收获/灌溉”等 → 选择 \"farmland\"\n- 出现“洞穴/矿井/地下/岩洞/潮湿”等 → 选择 \"cave\"\n- 出现“废弃/破败/尘封/被遗忘”等 → 选择 \"abandoned\"\n- 出现“魔法/法阵/仪式/奥术/神殿”等 → 选择 \"magic\"\n- 出现“战斗/竞技/血迹/祭坛/冲突”等 → 选择 \"combat\"\n- 普通室内或无明显特征 → 选择 \"normal\"\n\n**重要**：\n1. 请依据任务内容与环境氛围自然选择主题，不强调“越深越像地牢”\n2. 各阶段可根据剧情需要选择同类或不同主题，以突出叙事节奏与变化\n3. 主题需与名称和描述相呼应，营造统一而清晰的场景感",
      "required_params": ["width", "height", "depth", "theme"],
      "optional_params": {"quest_info": ""},
      "description": "生成地图基本信息（名称、描述和地板主题）",
      "version": "1.3"
    },
    "item_pickup_generation": {
      "name": "item_pickup_generation",
      "category": "item_system",
      "template": "为一个DnD风格的冒险游戏生成一个物品，玩家刚刚在地图上发现了它。\n\n玩家信息：\n- 名称：{player_name}\n- 职业：{player_class}\n- 等级：{player_level}\n- 当前位置：{player_position}\n\n地图信息：\n- 地图名称：{map_name}\n- 地图描述：{map_description}\n- 地图深度：{map_depth}层\n\n拾取上下文：{pickup_context}\n\n请生成一个适合当前情况的物品，要求：\n1. 必须有中文名称\n2. 详细的功能和使用场景介绍\n3. 物品类型必须是 weapon/armor/consumable/misc 之一\n4. 稀有度要符合地图深度和玩家等级\n5. 使用说明要清晰明确\n6. 建议提供 effect_payload 作为物品的固定效果单源真相（可选）\n7. 当 item_type=weapon 或 armor 时，必须返回 is_equippable=true，且 equip_slot 分别为 weapon/armor（除非明确是饰品）\n8. 当 item_type=consumable 时，必须返回 is_equippable=false，equip_slot=\"\"\n9. 对非消耗类物品，禁止返回会导致一次使用后消失的语义\n\n请返回JSON格式的物品数据。",
      "required_params": ["player_name", "player_class", "player_level", "player_position", "map_name", "map_description", "map_depth", "pickup_context"],
      "optional_params": {},
      "schema": {
        "type": "object",
        "properties": {
          "name": {"type": "string"},
          "description": {"type": "string"},
          "item_type": {"type": "string", "enum": ["weapon", "armor", "consumable", "misc"]},
          "rarity": {"type": "string", "enum": ["common", "uncommon", "rare", "epic", "legendary"]},
          "value": {"type": "integer", "minimum": 1},
          "weight": {"type": "number", "minimum": 0.1},
          "usage_description": {"type": "string"},
          "damage": {"type": "integer", "minimum": 0},
          "armor_class": {"type": "integer", "minimum": 0},
          "healing": {"type": "integer", "minimum": 0},
          "mana_restore": {"type": "integer", "minimum": 0},
          "is_equippable": {"type": "boolean"},
          "equip_slot": {"type": "string", "enum": ["", "weapon", "armor", "accessory_1", "accessory_2"]},
          "max_charges": {"type": "integer", "minimum": 0},
          "cooldown_turns": {"type": "integer", "minimum": 0},
          "effect_payload": {"type": "object"},
          "consumption_policy": {"type": "string", "enum": ["consume_on_use", "keep_on_use"]}
        },
        "required": ["name", "description", "item_type", "rarity", "value", "weight", "usage_description", "is_equippable", "equip_slot"]
      },
      "description": "生成玩家拾取的物品",
      "version": "2.0"
    },
    "quest_generation": {
      "name": "quest_generation",
      "category": "quest_system", 
      "template": "请为等级{player_level}的玩家生成一个DnD风格的任务。\n\n上下文信息：{context}\n\n请返回JSON格式的任务数据，包含：\n- title: 任务标题\n- description: 任务描述\n- objectives: 目标列表（字符串数组）\n- experience_reward: 经验奖励\n\n确保任务适合玩家等级，有趣且具有挑战性。",
      "required_params": ["player_level"],
      "optional_params": {"context": ""},
      "schema": {
        "type": "object",
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "objectives": {
            "type": "array",
            "items": {"type": "string"}
          },
          "experience_reward": {"type": "integer", "minimum": 0}
        },
        "required": ["title", "description", "objectives", "experience_reward"]
      },
      "description": "生成适合玩家等级的任务",
      "version": "1.0"
    },
    "quest_event_story": {
      "name": "quest_event_story",
      "category": "quest_system",
      "template": "为玩家生成一个任务相关的故事事件。\n\n事件信息：\n- 事件名称：{event_name}\n- 事件描述：{event_description}\n- 是否必须：{is_mandatory}\n\n玩家当前位置：({player_x}, {player_y})\n玩家等级：{player_level}\n地图：{map_name}\n\n请生成一个与任务相关的生动故事描述（100-150字），体现事件的重要性。",
      "required_params": ["event_name", "event_description", "is_mandatory", "player_x", "player_y", "player_level", "map_name"],
      "optional_params": {},
      "description": "生成任务相关的故事事件",
      "version": "1.0"
    },
    "general_narrative": {
      "name": "general_narrative",
      "category": "narrative",
      "template": "玩家信息：\n- 名称：{player_name}\n- 等级：{player_level}\n- 生命值：{player_hp}/{player_max_hp}\n- 位置：{player_position}\n\n当前地图：{map_name}\n回合数：{turn_count}\n\n上下文信息：\n- 最近事件：{recent_events}\n- 战斗情况：{combat_summary}\n- 移动情况：{movement_pattern}\n- 环境状态：{environmental_state}\n- 任务状态：{quest_status}\n\n刚刚发生的事件：{current_events}\n主要行动：{primary_action}\n\n请根据当前情况和上下文信息，生成一段连贯的叙述文本，\n描述行动的结果、环境的变化和玩家的感受。(80-120字)",
      "required_params": ["player_name", "player_level", "player_hp", "player_max_hp", "player_position", "map_name", "turn_count", "recent_events", "combat_summary", "movement_pattern", "environmental_state", "quest_status", "current_events", "primary_action"],
      "optional_params": {},
      "description": "生成通用的游戏叙述文本",
      "version": "1.0"
    },
    "monster_generation": {
      "name": "monster_generation",
      "category": "combat_system",
      "template": "为等级{player_level}的玩家生成一个DnD风格的怪物。\n\n难度要求：{difficulty}\n上下文信息：{context}\n\n请返回JSON格式的怪物数据，包含：\n- name: 怪物名称（**必须是中文**，不要使用英文或拼音）\n- description: 怪物描述（中文）\n- creature_type: 生物类型（中文）\n- stats: 属性数据（hp, attack, defense等）\n- abilities: 特殊能力列表（中文描述）\n\n**重要要求**：\n1. 怪物名称必须是纯中文，例如：\"暗影狼\"、\"骷髅战士\"、\"火焰元素\"\n2. 不要使用英文名称或拼音\n3. 确保怪物适合玩家等级和指定难度\n4. 所有描述性文本都应该使用中文",
      "required_params": ["player_level", "difficulty"],
      "optional_params": {"context": ""},
      "description": "生成适合玩家等级的怪物",
      "version": "1.0"
    },
    "item_usage_effect": {
      "name": "item_usage_effect",
      "category": "item_system",
      "template": "玩家正在使用一个物品，请根据物品属性和当前游戏状态，生成使用效果。\n\n物品信息：\n- 名称：{item_name}\n- 描述：{item_description}\n- 类型：{item_type}\n- 稀有度：{item_rarity}\n- 使用说明：{item_usage_description}\n- 属性：{item_properties}\n\n玩家信息：\n- 名称：{player_name}\n- 职业：{player_class}\n- 等级：{player_level}\n- 生命值：{player_hp}/{player_max_hp}\n- 法力值：{player_mp}/{player_max_mp}\n- 护甲等级：{player_ac}\n- 经验值：{player_experience}\n- 当前位置：{player_position}\n\n地图信息：{map_info}\n\n请生成结构化JSON效果，支持以下能力：\n1) 即时数值变化：stat_changes, ability_changes\n2) 位移和地图影响：teleport, map_changes\n3) 背包变化：inventory_changes(add_items/remove_items)\n4) 持续状态：apply_status_effects/remove_status_effects\n5) 特殊效果：special_effects（支持字符串code或对象{{\"code\":\"...\"}}）\n\n持续状态字段规范：\n- name: 状态名称（中文）\n- effect_type: buff/debuff/neutral\n- duration_turns: 持续回合数（>=1）\n- stacks/max_stacks/stack_policy: 叠加规则\n- tick_effects: 每回合生效的增减值（如{{\"hp\":-3}}）\n- modifiers/potency/tags/triggers/metadata: 可选扩展字段\n\n消耗规则（必须遵守）：\n- item_type 为 weapon/armor 时，item_consumed 必须为 false\n- item_type 为 consumable 时，item_consumed 通常为 true，除非文本明确说明可重复使用\n- 不能让描述为护甲/盾牌/武器的物品一次使用后消失\n\n重要：\n- 只输出JSON，不要额外解释\n- 效果必须与物品设定和当前局势匹配\n- 避免过度超模（除非物品本身是高稀有强力道具）",
      "required_params": ["item_name", "item_description", "item_type", "item_rarity", "item_usage_description", "item_properties", "player_name", "player_class", "player_level", "player_hp", "player_max_hp", "player_mp", "player_max_mp", "player_ac", "player_experience", "player_position", "map_info"],
      "optional_params": {},
      "description": "生成物品使用的效果",
      "version": "2.0"
    },
    "map_description": {
      "name": "map_description",
      "category": "map_generation",
      "template": "请为当前地图/场景/区域生成一个生动的描述。\n\n地图信息：\n- 名称：{map_name}\n- 大小：{width}x{height}\n- 层数：{depth}\n\n上下文信息：{context}\n\n请生成一个富有想象力的地图描述，包括环境、氛围、可能的危险等。",
      "required_params": ["map_name", "width", "height", "depth"],
      "optional_params": {"context": ""},
      "description": "生成详细的地图环境描述",
      "version": "1.1"
    },
    "combat_victory_narrative": {
      "name": "combat_victory_narrative",
      "category": "combat_system",
      "template": "玩家刚刚在战斗中击败了一个敌人，请生成一段生动的战斗胜利叙述。\n\n玩家信息：\n- 名称：{player_name}\n- 等级：{player_level}\n- 生命值：{player_hp}/{player_max_hp}\n\n被击败的敌人：\n- 名称：{monster_name}\n- 描述：{monster_description}\n- 是否为Boss：{is_boss}\n- 是否为任务怪物：{is_quest_monster}\n\n战斗结果：\n- 造成伤害：{damage_dealt}\n- 获得经验：{experience_gained}\n- 是否升级：{level_up}\n- 掉落物品：{loot_items}\n- 任务进度：{quest_progress}%\n\n当前位置：\n- 地图：{map_name}\n- 层数：{map_depth}{quest_info}\n\n请生成一段80-150字的战斗胜利叙述，要求：\n1. 描述战斗的激烈程度和玩家的表现\n2. 突出敌人的特点和被击败的过程\n3. 如果是Boss或任务怪物，要强调其重要性\n4. 如果升级了，要体现玩家的成长\n5. 如果有掉落物品，可以简单提及\n6. 语气要符合DnD冒险风格，富有史诗感\n7. 使用第二人称（你）来称呼玩家",
      "required_params": ["player_name", "player_level", "player_hp", "player_max_hp", "monster_name", "monster_description", "is_boss", "is_quest_monster", "damage_dealt", "experience_gained", "level_up", "loot_items", "quest_progress", "map_name", "map_depth"],
      "optional_params": {"quest_info": ""},
      "description": "生成战斗胜利后的叙述文本",
      "version": "1.0"
    },
    "quest_completion_choices": {
      "name": "quest_completion_choices",
      "category": "quest_system",
      "template": "玩家{player_name}（等级{player_level}）刚刚完成了任务：{quest_title}\n\n任务描述：{quest_description}\n任务类型：{quest_type}\n经验奖励：{experience_reward}\n故事背景：{story_context}\n\n当前位置：{current_map}（第{map_depth}层）\n\n请为任务完成后的情况生成4个有意义的选项，每个选项应该：\n1. 有清晰的标题和详细描述\n2. 说明选择后的后果\n3. 至少有1-2个选项会引导创建新任务\n4. 至少有1个选项会触发地图切换\n5. 选项应该多样化，包括：继续冒险、祈祷整理、探索新区域、接受新委托等\n\n请返回JSON格式：\n{{\n    \"title\": \"任务完成标题（例如：光明重现！）\",\n    \"description\": \"任务完成后的场景描述（2-3句话，描述任务完成的成就感和周围环境）\",\n    \"choices\": [\n        {{\n            \"text\": \"选项标题\",\n            \"description\": \"选项详细描述\",\n            \"consequences\": \"选择后的后果说明\",\n            \"leads_to_new_quest\": true/false,\n            \"leads_to_map_transition\": true/false,\n            \"quest_theme\": \"新任务主题（如果leads_to_new_quest为true）\",\n            \"map_theme\": \"新地图主题（如果leads_to_map_transition为true）\",\n            \"requirements\": {{}}\n        }}\n    ]\n}}",
      "required_params": ["quest_title", "quest_description", "quest_type", "player_name", "player_level", "experience_reward", "story_context", "current_map", "map_depth"],
      "optional_params": {},
      "schema": {
        "type": "object",
        "properties": {
          "title": {"type": "string"},
          "description": {"type": "string"},
          "choices": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "text": {"type": "string"},
                "description": {"type": "string"},
                "consequences": {"type": "string"},
                "leads_to_new_quest": {"type": "boolean"},
                "leads_to_map_transition": {"type": "boolean"},
                "quest_theme": {"type": "string"},
                "map_theme": {"type": "string"},
                "requirements": {"type": "object"}
              },
              "required": ["text", "description", "consequences"]
            }
          }
        },
        "required": ["title", "description", "choices"]
      },
      "description": "生成任务完成后的选项",
      "version": "1.0"
    },
    "process_quest_completion_choice": {
      "name": "process_quest_completion_choice",
      "category": "quest_system",
      "template": "玩家{player_name}（等级{player_level}）完成任务后选择了：{choice_text}\n\n选项描述：{choice_description}\n是否创建新任务：{leads_to_new_quest}\n是否切换地图：{leads_to_map_transition}\n新任务主题：{quest_theme}\n新地图主题：{map_theme}\n\n已完成的任务信息：{completed_quest_data}\n\n当前位置：{current_map}（第{map_depth}层）\n\n请处理这个选择并返回JSON格式：\n{{\n    \"message\": \"选择结果的叙述（2-3句话，描述玩家的行动和周围的变化）\",\n    \"events\": [\"事件1\", \"事件2\"],\n    \"quest_updates\": {{\n        \"已完成任务ID\": {{\n            \"is_active\": false,\n            \"is_completed\": true\n        }}\n    }},\n    \"player_updates\": {{\n        \"hp\": 变化值（可选）,\n        \"mana\": 变化值（可选）\n    }},\n    \"new_quest_data\": {{\n        \"title\": \"新任务标题\",\n        \"description\": \"新任务描述\",\n        \"quest_type\": \"main/side/daily\",\n        \"objectives\": [\"目标1\", \"目标2\", \"目标3\"],\n        \"experience_reward\": 经验奖励数值,\n        \"story_context\": \"故事背景\",\n        \"special_events\": [\n            {{\n                \"event_id\": \"事件ID\",\n                \"description\": \"事件描述\",\n                \"floor_number\": 楼层号,\n                \"progress_value\": 进度值（建议8-12）\n            }}\n        ],\n        \"special_monsters\": [\n            {{\n                \"monster_id\": \"怪物ID\",\n                \"name\": \"怪物名称\",\n                \"floor_number\": 楼层号,\n                \"is_boss\": true/false,\n                \"progress_value\": 进度值（普通怪物10-15，Boss 15-20）\n            }}\n        ]\n    }},\n    \"map_transition\": {{\n        \"should_transition\": true/false,\n        \"new_map_theme\": \"地图主题\",\n        \"new_map_name\": \"新地图名称\",\n        \"new_map_description\": \"新地图描述\",\n        \"target_depth\": 目标楼层（通常为1）\n    }}\n}}\n\n**重要说明**：\n1. 如果leads_to_new_quest为true，必须提供完整的new_quest_data\n2. 如果leads_to_map_transition为true，必须提供完整的map_transition数据\n3. 新任务的special_events和special_monsters的进度值总和应该在40-50%之间\n4. 确保新任务有明确的目标和合理的奖励",
      "required_params": ["choice_text", "choice_description", "leads_to_new_quest", "leads_to_map_transition", "quest_theme", "map_theme", "completed_quest_data", "player_name", "player_level", "current_map", "map_depth"],
      "optional_params": {},
      "schema": {
        "type": "object",
        "properties": {
          "message": {"type": "string"},
          "events": {"type": "array", "items": {"type": "string"}},
          "quest_updates": {"type": "object"},
          "player_updates": {"type": "object"},
          "new_quest_data": {
            "type": "object",
            "properties": {
              "title": {"type": "string"},
              "description": {"type": "string"},
              "quest_type": {"type": "string"},
              "objectives": {"type": "array", "items": {"type": "string"}},
              "experience_reward": {"type": "integer"},
              "story_context": {"type": "string"},
              "special_events": {"type": "array"},
              "special_monsters": {"type": "array"}
            }
          },
          "map_transition": {
            "type": "object",
            "properties": {
              "should_transition": {"type": "boolean"},
              "new_map_theme": {"type": "string"},
              "new_map_name": {"type": "string"},
              "new_map_description": {"type": "string"},
              "target_depth": {"type": "integer"}
            }
          }
        },
        "required": ["message", "events"]
      },
      "description": "处理任务完成后的选择并生成新任务",
      "version": "1.0"
    },
    "trap_narrative": {
      "name": "trap_narrative",
      "category": "narrative",
      "template": "你是一个DND风格地下城游戏的叙述者。玩家触发了一个陷阱，请生成一段生动的描述性文本。\n\n玩家信息：\n- 名称：{player_name}\n- 等级：{player_level}\n- 生命值：{player_hp}/{player_max_hp}\n- 位置：{player_position}\n\n地图信息：\n- 地图名称：{map_name}\n- 层数：{map_depth}\n\n陷阱信息：\n- 名称：{trap_name}\n- 类型：{trap_type}\n- 造成伤害：{damage}点 {damage_type}伤害\n- 是否尝试豁免：{save_attempted}\n- 豁免是否成功：{save_success}\n\n请根据以上信息，生成一段简短但生动的描述（2-3句话），描述陷阱触发的场景和效果。要有画面感和紧张感。",
      "required_params": ["player_name", "player_level", "player_hp", "player_max_hp", "player_position", "map_name", "map_depth", "trap_name", "trap_type", "damage", "damage_type", "save_attempted", "save_success"],
      "optional_params": {},
      "description": "生成陷阱触发时的叙述文本",
      "version": "1.0"
    }
  },
  "fallback_messages": {
    "combat_defense": "你感受到了敌人攻击的冲击，但依然坚持战斗。",
    "combat_attack": "你的攻击命中了目标，战斗继续进行。",
    "movement": "你谨慎地移动到新的位置，观察着周围的环境。",
    "item_use": "你使用了物品，感受到了它带来的效果。",
    "event_trigger": "你触发了一个事件，情况发生了变化。",
    "default": "你继续着冒险的旅程。"
  }
}
