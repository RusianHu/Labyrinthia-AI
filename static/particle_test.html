<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç²’å­ç³»ç»Ÿæµ‹è¯• - Labyrinthia AI</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/enhanced_effects.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', 'Noto Sans CJK SC', sans-serif;
            background: #1a1a2e;
            color: #fff;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d4ff;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-size: 14px;
            color: #aaa;
        }

        select, button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        select {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }

        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .test-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .test-box {
            position: relative;
            height: 400px;
            background: #2c3e50;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .test-box-title {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            z-index: 100;
        }

        .test-box-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            z-index: 100;
        }

        /* ç¯å¢ƒç²’å­å®¹å™¨ */
        .environment-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        /* ç²’å­æ ·å¼ */
        .particle-dust {
            filter: blur(1px);
        }

        .particle-leaves {
            filter: blur(0.5px);
            transform-origin: center;
        }

        .particle-sunlight {
            filter: blur(2px);
            box-shadow: 0 0 10px rgba(255, 235, 59, 0.6);
        }

        .particle-rain {
            width: 2px !important;
            height: 20px !important;
            background: linear-gradient(to bottom, rgba(173, 216, 230, 0.8), transparent) !important;
            border-radius: 1px;
        }

        .particle-snow {
            filter: blur(1px);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
        }

        .particle-sand {
            filter: blur(0.5px);
        }

        /* åœ°æ¿èƒŒæ™¯æ¨¡æ‹Ÿ */
        .floor-normal {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }

        .floor-grassland {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
        }

        .floor-town {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .floor-cave {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        }

        .floor-abandoned {
            background: linear-gradient(135deg, #5d4037 0%, #4e342e 100%);
        }

        .floor-desert {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .floor-snowfield {
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
        }

        .stats {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .stats h3 {
            margin-bottom: 10px;
            color: #00d4ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 6px;
        }

        .stat-label {
            font-size: 12px;
            color: #aaa;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #00d4ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ ç¯å¢ƒç²’å­ç³»ç»Ÿæµ‹è¯•</h1>

        <div class="controls">
            <div class="control-group">
                <label>é€‰æ‹©ä¸»é¢˜</label>
                <select id="theme-select">
                    <option value="normal">Normal (åœ°ç‰¢-è½ç°)</option>
                    <option value="abandoned">Abandoned (åºŸå¼ƒ-æµ“ç°)</option>
                    <option value="cave">Cave (æ´ç©´-è½ç°)</option>
                    <option value="magic">Magic (é­”æ³•-ç´«è‰²ç°å°˜)</option>
                    <option value="combat">Combat (æˆ˜æ–—-çº¢è‰²ç°å°˜)</option>
                    <option value="grassland">Grassland (è‰åœ°-è½å¶)</option>
                    <option value="town">Town (åŸé•‡-é˜³å…‰)</option>
                    <option value="desert">Desert (æ²™æ¼ -æ²™å°˜)</option>
                    <option value="snowfield">Snowfield (é›ªåœ°-é›ªèŠ±)</option>
                    <option value="farmland">Farmland (å†œç”°-ç»¿å¶)</option>
                </select>
            </div>

            <button id="apply-btn">åº”ç”¨åˆ°æ‰€æœ‰æµ‹è¯•æ¡†</button>
            <button id="clear-btn">æ¸…é™¤æ‰€æœ‰ç²’å­</button>
            <button id="toggle-stats">æ˜¾ç¤º/éšè—ç»Ÿè®¡</button>
        </div>

        <div class="test-area" id="test-area">
            <!-- æµ‹è¯•æ¡†å°†é€šè¿‡ JavaScript åŠ¨æ€ç”Ÿæˆ -->
        </div>

        <div class="stats" id="stats" style="display: none;">
            <h3>ğŸ“Š æ€§èƒ½ç»Ÿè®¡</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">æ´»è·ƒç²’å­ç³»ç»Ÿ</div>
                    <div class="stat-value" id="stat-systems">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ€»ç²’å­æ•°</div>
                    <div class="stat-value" id="stat-particles">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">æ´»è·ƒåŠ¨ç”»</div>
                    <div class="stat-value" id="stat-animations">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Anime.js çŠ¶æ€</div>
                    <div class="stat-value" id="stat-anime">æœªåŠ è½½</div>
                </div>
            </div>
        </div>
    </div>

    <!-- åŠ è½½ anime.js -->
    <script src="js/anime.min.js"></script>

    <!-- åŠ è½½ EnhancedEffectsManager -->
    <script src="EnhancedEffectsManager.js"></script>

    <script>
        // åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„æ¸¸æˆå¯¹è±¡
        const mockGame = {
            addMessage: (msg, type) => console.log(`[${type}] ${msg}`)
        };

        // åˆå§‹åŒ–ç‰¹æ•ˆç®¡ç†å™¨
        const effectsManager = new EnhancedEffectsManager(mockGame);

        // ä¸»é¢˜é…ç½®
        const themes = [
            { id: 'normal', name: 'Normal (åœ°ç‰¢)', floor: 'floor-normal' },
            { id: 'abandoned', name: 'Abandoned (åºŸå¼ƒ)', floor: 'floor-abandoned' },
            { id: 'cave', name: 'Cave (æ´ç©´)', floor: 'floor-cave' },
            { id: 'magic', name: 'Magic (é­”æ³•)', floor: 'floor-normal' },
            { id: 'combat', name: 'Combat (æˆ˜æ–—)', floor: 'floor-normal' },
            { id: 'grassland', name: 'Grassland (è‰åœ°)', floor: 'floor-grassland' },
            { id: 'town', name: 'Town (åŸé•‡)', floor: 'floor-town' },
            { id: 'desert', name: 'Desert (æ²™æ¼ )', floor: 'floor-desert' },
            { id: 'snowfield', name: 'Snowfield (é›ªåœ°)', floor: 'floor-snowfield' },
            { id: 'farmland', name: 'Farmland (å†œç”°)', floor: 'floor-grassland' }
        ];

        // åˆ›å»ºæµ‹è¯•æ¡†
        function createTestBoxes() {
            const testArea = document.getElementById('test-area');
            testArea.innerHTML = '';

            themes.forEach(theme => {
                const box = document.createElement('div');
                box.className = `test-box ${theme.floor}`;
                box.id = `test-box-${theme.id}`;
                box.innerHTML = `
                    <div class="test-box-title">${theme.name}</div>
                    <div class="test-box-info">
                        <div>ä¸»é¢˜: <strong>${theme.id}</strong></div>
                        <div>ç²’å­æ•°: <span id="count-${theme.id}">0</span></div>
                    </div>
                `;
                testArea.appendChild(box);
            });
        }

        // åº”ç”¨ç²’å­æ•ˆæœåˆ°å•ä¸ªæµ‹è¯•æ¡†
        function applyParticlesToBox(themeId) {
            const box = document.getElementById(`test-box-${themeId}`);
            if (!box) return;

            // æ¸…é™¤æ—§çš„ç²’å­
            const oldParticles = box.querySelector('.environment-particles');
            if (oldParticles) {
                oldParticles.remove();
            }

            // åˆ›å»ºæ–°çš„ç²’å­
            effectsManager.createEnvironmentParticles(box, themeId);

            // æ›´æ–°ç²’å­è®¡æ•°
            const particleContainer = box.querySelector('.environment-particles');
            if (particleContainer) {
                const count = particleContainer.children.length;
                document.getElementById(`count-${themeId}`).textContent = count;
            }
        }

        // åº”ç”¨åˆ°æ‰€æœ‰æµ‹è¯•æ¡†
        function applyToAll() {
            const selectedTheme = document.getElementById('theme-select').value;
            themes.forEach(theme => {
                applyParticlesToBox(selectedTheme);
            });
            updateStats();
        }

        // æ¸…é™¤æ‰€æœ‰ç²’å­
        function clearAll() {
            effectsManager.clearEnvironmentParticles();
            themes.forEach(theme => {
                document.getElementById(`count-${theme.id}`).textContent = '0';
            });
            updateStats();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('stat-systems').textContent = effectsManager.particleSystems.size;

            let totalParticles = 0;
            effectsManager.particleSystems.forEach(system => {
                totalParticles += system.particles.length;
            });
            document.getElementById('stat-particles').textContent = totalParticles;

            document.getElementById('stat-animations').textContent = effectsManager.activeAnimations.size;
            document.getElementById('stat-anime').textContent = typeof anime !== 'undefined' ? 'âœ… å·²åŠ è½½' : 'âŒ æœªåŠ è½½';
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('apply-btn').addEventListener('click', applyToAll);
        document.getElementById('clear-btn').addEventListener('click', clearAll);
        document.getElementById('toggle-stats').addEventListener('click', () => {
            const stats = document.getElementById('stats');
            stats.style.display = stats.style.display === 'none' ? 'block' : 'none';
            updateStats();
        });

        // åˆå§‹åŒ–
        createTestBoxes();

        // è‡ªåŠ¨åº”ç”¨æ¯ä¸ªä¸»é¢˜åˆ°å¯¹åº”çš„æµ‹è¯•æ¡†
        setTimeout(() => {
            themes.forEach(theme => {
                applyParticlesToBox(theme.id);
            });
            updateStats();
            console.log('âœ… ç²’å­ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ“Š EnhancedEffectsManager:', effectsManager);
        }, 500);
    </script>
</body>
</html>

